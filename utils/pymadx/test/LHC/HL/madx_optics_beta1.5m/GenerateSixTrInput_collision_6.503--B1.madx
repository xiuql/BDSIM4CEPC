title, "V6.5 Thins Lens" ;

! sequence, strength etc
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

 system,"ln -fns /afs/cern.ch/eng/lhc/optics/V6.503 db";
 system,"ln -fns /afs/cern.ch/eng/lhc/optics/V6.503/toolkit lt";
! system,"ln -fns /afs/cern.ch/eng/sl/lhc-collimation/code/V6.503 db";
! system,"ln -fns /afs/cern.ch/eng/sl/lhc-collimation/code/V6.503/toolkit lt";

 option, -echo, -info,  warn;
 call,   file = "db/V6.5.thin.seq";
! call,   file = "db/V6.5.thin.coll.str";
! call,   file = "db/V6.5.thin.coll_special.3.5TeV_3.5m.str"
 call,   file = "db/V6.5.thin.coll_special.3.5TeV_1.5m10.0m1.5m3.0m.str"

 option,  echo,  info,  warn;
 set,format="11.6f"; 

call, file="/afs/cern.ch/eng/sl/lhc-collimation/code/MADX/Lattice/tools/tcla_tcdq.thin.b1.madx";

! beam parameters
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
! beam,   sequence=lhcb1, particle=proton, pc= 450;
! beam,   sequence=lhcb1, particle=proton, pc=7000;
 beam,   sequence=lhcb1, particle=proton, pc=3500;
 

! crossing angle, separation, spectrometers
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        on_x1:=-1; on_sep1:=0; on_o1:=0;
        on_x2:=1; on_sep2:=0; on_o2:=0; on_a2:=0;
        on_x5:= 1; on_sep5:=0; on_o5:=0;
        on_x8:=1; on_sep8:=0; on_o8:=0; on_a8:=0;
        on_alice:=2;
        on_lhcb:=-2;

 seqedit, sequence=lhcb1;
   flatten;
!   cycle, start=IP3.B1;
 endedit;

 use,    period=lhcb1;

! Chromaticity and tune corrections
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 call, file="/afs/cern.ch/eng/sl/lhc-collimation/code/MADX/Lattice/tools/MatchChromaticity.madx";
 call, file="/afs/cern.ch/eng/sl/lhc-collimation/code/MADX/Lattice/tools/MatchTune.lowb.madx";
!

! twiss B1 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 select, flag=twiss, clear;
 select, flag=twiss, column=name,keyword,s,betx,bety,mux,muy,dx,dpx,x,px,y,py,dy,dpy,aper_1,aper_2,aper_3,aper_4;
 twiss,  sequence=lhcb1, file=twiss_b1.data.thin, save;

 sixtrack, radius=17E-03;

 system, "/home/roderik/My_CERN_work/lhc_optics_db_local_2010.02.05/ChangeSixStart.scr";

 system, "rm db lt";

stop;
